{% extends "base.html" %}

{% block title %}إدارة الأسرّة - نظام إدارة المستشفى{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2><i class="bi bi-hospital"></i> إدارة الأسرّة</h2>
    </div>
    <div class="col-md-4 text-start">
        <a href="{{ url_for('facility.admissions_list') }}" class="btn btn-primary">
            <i class="bi bi-person-plus"></i> قائمة الإدخالات
        </a>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">إجمالي الأسرّة</h6>
                        <h2 class="mb-0">{{ total_beds }}</h2>
                    </div>
                    <i class="bi bi-hospital text-primary" style="font-size: 2.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">متاح</h6>
                        <h2 class="mb-0 text-success">{{ available_beds }}</h2>
                    </div>
                    <i class="bi bi-check-circle text-success" style="font-size: 2.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-danger">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">مشغول</h6>
                        <h2 class="mb-0 text-danger">{{ occupied_beds }}</h2>
                    </div>
                    <i class="bi bi-person-fill text-danger" style="font-size: 2.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">تحت الصيانة</h6>
                        <h2 class="mb-0 text-warning">{{ maintenance_beds }}</h2>
                    </div>
                    <i class="bi bi-tools text-warning" style="font-size: 2.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Occupancy Progress -->
<div class="card mb-4">
    <div class="card-body">
        <h6>نسبة الإشغال: {{ ((occupied_beds / total_beds) * 100)|round(1) }}%</h6>
        <div class="progress" style="height: 30px;">
            <div class="progress-bar bg-danger" role="progressbar" 
                 style="width: {{ (occupied_beds / total_beds * 100)|round(1) }}%">
                {{ occupied_beds }} مشغول
            </div>
            <div class="progress-bar bg-success" role="progressbar" 
                 style="width: {{ (available_beds / total_beds * 100)|round(1) }}%">
                {{ available_beds }} متاح
            </div>
        </div>
    </div>
</div>

<!-- Beds by Room -->
{% for room_number, beds in rooms.items() %}
<div class="card mb-3">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-door-open"></i> غرفة {{ room_number }}</h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            {% for bed in beds %}
            <div class="col-md-4 col-lg-3">
                <div class="card h-100 border-2
                    {% if bed.status.value == 'available' %}border-success
                    {% elif bed.status.value == 'occupied' %}border-danger
                    {% else %}border-warning{% endif %}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-bed"></i> سرير {{ bed.bed_label }}
                            </h5>
                            <span class="badge
                                {% if bed.status.value == 'available' %}bg-success
                                {% elif bed.status.value == 'occupied' %}bg-danger
                                {% else %}bg-warning{% endif %}">
                                {% if bed.status.value == 'available' %}متاح
                                {% elif bed.status.value == 'occupied' %}مشغول
                                {% else %}صيانة{% endif %}
                            </span>
                        </div>
                        
                        {% if bed.status.value == 'occupied' and bed.id in admission_map %}
                        <hr>
                        <p class="mb-1"><strong>المريض:</strong></p>
                        <p class="mb-0">
                            <a href="{{ url_for('patients.view_patient', patient_id=admission_map[bed.id].patient.id) }}">
                                {{ admission_map[bed.id].patient.full_name }}
                            </a>
                        </p>
                        <p class="text-muted small mb-0">
                            منذ: {{ admission_map[bed.id].admission_date.strftime('%Y-%m-%d %H:%M') }}
                        </p>
                        {% endif %}
                        
                        <div class="mt-3">
                            <a href="{{ url_for('facility.bed_detail', bed_id=bed.id) }}" 
                               class="btn btn-sm btn-outline-primary w-100">
                                <i class="bi bi-eye"></i> التفاصيل
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endfor %}

<!-- Quick Actions -->
<div class="card">
    <div class="card-body text-center">
        <a href="{{ url_for('facility.admit_patient') }}" class="btn btn-success btn-lg me-2">
            <i class="bi bi-person-plus-fill"></i> إدخال مريض جديد
        </a>
        <a href="{{ url_for('facility.admissions_list') }}" class="btn btn-primary btn-lg">
            <i class="bi bi-list-ul"></i> عرض جميع الإدخالات
        </a>
    </div>
</div>
{% endblock %}