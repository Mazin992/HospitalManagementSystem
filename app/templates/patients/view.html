{% extends "base.html" %}

{% block title %}{{ patient.full_name }} - نظام إدارة المستشفى{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2><i class="bi bi-person-circle"></i> {{ patient.full_name }}</h2>
        <p class="text-muted">رقم الملف: <strong>{{ patient.file_number }}</strong></p>
    </div>
    <div class="col-md-4 text-start">
        <a href="{{ url_for('appointments.book_appointment', patient_id=patient.id) }}" class="btn btn-success">
            <i class="bi bi-calendar-plus"></i> حجز موعد
        </a>
        <a href="{{ url_for('patients.edit_patient', patient_id=patient.id) }}" class="btn btn-warning">
            <i class="bi bi-pencil"></i> تعديل
        </a>
    </div>
</div>

<div class="row">
    <!-- Patient Info Card -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">المعلومات الشخصية</h5>
            </div>
            <div class="card-body">
                <p><strong>الاسم الكامل:</strong><br>{{ patient.full_name }}</p>
                <p><strong>رقم الهاتف:</strong><br>{{ patient.phone }}</p>
                <p><strong>الجنس:</strong><br>
                    {% if patient.gender == 'M' %}ذكر
                    {% elif patient.gender == 'F' %}أنثى
                    {% else %}غير محدد{% endif %}
                </p>
                {% if patient.dob %}
                <p><strong>تاريخ الميلاد:</strong><br>{{ patient.dob.strftime('%Y-%m-%d') }}</p>
                {% endif %}
                {% if patient.address %}
                <p><strong>العنوان:</strong><br>{{ patient.address }}</p>
                {% endif %}
                {% if patient.emergency_contact %}
                <p><strong>جهة الطوارئ:</strong><br>{{ patient.emergency_contact }}</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Recent Appointments -->
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-calendar-event"></i> المواعيد الأخيرة</h5>
            </div>
            <div class="card-body">
                {% if recent_appointments %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>الطبيب</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for appt in recent_appointments %}
                            <tr>
                                <td>{{ appt.date_time.strftime('%Y-%m-%d %H:%M') }}</td>
                                <td>{{ appt.doctor.full_name_ar }}</td>
                                <td>
                                    {% if appt.status.value == 'completed' %}
                                        <span class="badge bg-success">مكتمل</span>
                                    {% elif appt.status.value == 'confirmed' %}
                                        <span class="badge bg-primary">مؤكد</span>
                                    {% elif appt.status.value == 'cancelled' %}
                                        <span class="badge bg-danger">ملغي</span>
                                    {% else %}
                                        <span class="badge bg-warning">معلق</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">لا توجد مواعيد مسجلة</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<a href="{{ url_for('patients.list_patients') }}" class="btn btn-secondary">
    <i class="bi bi-arrow-right"></i> رجوع للقائمة
</a>
{% endblock %}